<div class="container-fluid mt-3">
  <div class="d-print-none">
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-3">
            <label class="form-label">Device</label>
            <select class="form-select" [(ngModel)]="deviceType" (change)="onTypeChange()">
              <option value="METER">METER</option>
              <option value="CT">CT</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">Report Type</label>
            <select class="form-select" [(ngModel)]="reportType">
              <option *ngFor="let t of reportTypes" [value]="t">{{ t }}</option>
            </select>
          </div>
          <div class="col-md-5 d-flex align-items-end justify-content-end gap-2">
            <button class="btn btn-outline-secondary" (click)="loadSample()">Load Sample</button>
            <button class="btn btn-dark" (click)="print()">üñ® Print</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PRINT AREA -->
  <div id="printArea" class="paper a4 shadow-sm bg-white p-3">

    <!-- 1) Batch Sheet (like first image) -->
    <ng-container *ngIf="reportType==='stopdefective' || reportType==='contested'">
      <div class="text-center">
        <div class="fw-bold" style="font-size:14px;">‡§Æ‡§ß‡•ç‡§Ø ‡§™‡•ç‡§∞‡§¶‡•á‡§∂ ‡§™‡§∂‡•ç‡§ö‡§ø‡§Æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§ ‡§µ‡§ø‡§§‡§∞‡§£ ‡§ï‡§Æ‡•ç‡§™‡§®‡•Ä ‡§≤‡§ø‡§Æ‡§ø‡§ü‡•á‡§°</div>
        <div class="fw-bold" style="font-size:13px;">‡§Ü‡§∞.‡§è‡§Æ.‡§ü‡•Ä.‡§è‡§≤., ‡§á‡§Ç‡§¶‡•å‡§∞</div>
      </div>

      <div class="row mt-2 small">
        <div class="col-6"><strong>‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞/‡§µ‡§ø‡§§‡§∞‡§£ ‡§ï‡•á‡§®‡•ç‡§¶‡•ç‡§∞:</strong> {{ batch.header.zone || '-' }}</div>
        <div class="col-3"><strong>‡§´‡•á‡§ú‡§º:</strong> {{ batch.header.phase || '-' }}</div>
        <div class="col-3 text-end"><strong>‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</strong> {{ batch.header.date }}</div>
      </div>

      <table class="table table-bordered table-sm mt-2 align-middle">
        <thead class="table-light text-center">
          <tr>
            <th style="width:42px;">‡§ï‡•ç‡§∞.</th>
            <th>‡§Æ‡•Ä‡§ü‡§∞ ‡§®‡§Ç‡§¨‡§∞</th>
            <th>‡§Æ‡•á‡§ï</th>
            <th>‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ</th>
            <th>‡§™‡§∞‡§ø‡§£‡§æ‡§Æ / Remarks</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of batch.rows; let i=index">
            <td class="text-center">{{ i+1 }}</td>
            <td>{{ r.serial }}</td>
            <td>{{ r.make }}</td>
            <td>{{ r.capacity }}</td>
            <td>{{ r.result }}</td>
          </tr>
          <tr *ngIf="!batch.rows?.length">
            <td colspan="5" class="text-center text-muted">No rows</td>
          </tr>
        </tbody>
      </table>

      <div class="row mt-4 small">
        <div class="col-6">
          <div class="sig-line">Tested by</div>
          <div>JUNIOR ENGINEER (RMTL)</div>
        </div>
        <div class="col-6 text-end">
          <div class="sig-line d-inline-block">Assistant Engineer</div>
          <div>R.M.T.L., MPPKVVCL</div>
        </div>
      </div>
    </ng-container>

    <!-- 2) Consumer/Contested Meter Form (like green form) -->
    <ng-container *ngIf="reportType==='P4_ONM' || reportType==='P4_vig' || reportType==='Solar netmeter' || reportType==='Solar Generation Meter'">
      <div class="text-center fw-bold mb-1">OFFICE OF AE/JE ‚Äî TEST RESULT FORM</div>

      <div class="border p-2 small">
        <div class="row">
          <div class="col-6"><strong>Name of Consumer:</strong> {{ contested.consumer_name }}</div>
          <div class="col-6"><strong>Account/IVRS:</strong> {{ contested.ivrs }}</div>
        </div>
        <div class="row">
          <div class="col-6"><strong>Address:</strong> {{ contested.address }}</div>
          <div class="col-6"><strong>By:</strong> {{ contested.by_whom }}</div>
        </div>
        <div class="row">
          <div class="col-4"><strong>MR No/Date:</strong> {{ contested.mr_no }}</div>
          <div class="col-4"><strong>Testing Fees:</strong> {{ contested.fees }}</div>
          <div class="col-4"><strong>Date of Testing:</strong> {{ contested.testing_date }}</div>
        </div>
      </div>

      <div class="row small mt-2">
        <div class="col-3"><strong>Meter No:</strong> {{ contested.meter.serial }}</div>
        <div class="col-3"><strong>Make:</strong> {{ contested.meter.make }}</div>
        <div class="col-3"><strong>Capacity:</strong> {{ contested.meter.capacity }}</div>
        <div class="col-3"><strong>Reading:</strong> {{ contested.meter.reading }}</div>
      </div>

      <table class="table table-sm table-bordered mt-2">
        <tbody class="small">
          <tr><th style="width:45%;">Physical Condition</th><td>{{ contested.checks.physical }}</td></tr>
          <tr><th>Whether Found Burnt</th><td>{{ contested.checks.burnt }}</td></tr>
          <tr><th>Meter Body Seal</th><td>{{ contested.checks.seal }}</td></tr>
          <tr><th>Meter Glass Cover</th><td>{{ contested.checks.glass }}</td></tr>
          <tr><th>Terminal Block</th><td>{{ contested.checks.terminal }}</td></tr>
          <tr><th>Meter Body</th><td>{{ contested.checks.body }}</td></tr>
          <tr><th>Any Other</th><td>{{ contested.checks.other }}</td></tr>
        </tbody>
      </table>

      <div class="row small">
        <div class="col-6"><strong>Before Test Reading:</strong> {{ contested.before }}</div>
        <div class="col-6"><strong>After Test Reading:</strong> {{ contested.after }}</div>
      </div>

      <div class="row small mt-2">
        <div class="col-3"><strong>% Error:</strong> {{ contested.error_pct }}</div>
        <div class="col-3"><strong>Starting Current:</strong> {{ contested.starting }}</div>
        <div class="col-3"><strong>Creep Test:</strong> {{ contested.creep }}</div>
        <div class="col-3"><strong>Other:</strong> {{ contested.other }}</div>
      </div>

      <div class="row mt-4 small">
        <div class="col-6">
          <div class="sig-line">JE/AE Sign</div>
        </div>
        <div class="col-6 text-end">
          <div class="sig-line d-inline-block">RMTL ‚Äî Tested By</div>
        </div>
      </div>
    </ng-container>

    <!-- 3) Certificate for CT (like last image) -->
    <ng-container *ngIf="deviceType==='CT' && reportType==='CT Testing'">
      <div class="text-center">
        <div class="fw-bold">OFFICE OF THE ASSISTANT ENGINEER (R.M.T.L.)</div>
        <div class="small">CERTIFICATE FOR C.T</div>
      </div>

      <div class="small mt-2">
        <div><strong>Name of Consumer:</strong> {{ ctCert.header.consumer }}</div>
        <div><strong>Address:</strong> {{ ctCert.header.address }}</div>
        <div class="row">
          <div class="col-4"><strong>No. of CT:</strong> {{ ctCert.header.ct_count }}</div>
          <div class="col-4"><strong>CT Class:</strong> {{ ctCert.header.ct_class }}</div>
          <div class="col-4"><strong>Date of Testing:</strong> {{ ctCert.header.testing_date }}</div>
        </div>
        <div class="row">
          <div class="col-6"><strong>M.R./Online Txn:</strong> {{ ctCert.header.txn }}</div>
          <div class="col-6"><strong>Amount:</strong> {{ ctCert.header.amount }}</div>
        </div>
      </div>

      <table class="table table-bordered table-sm mt-2 align-middle">
        <thead class="table-light text-center">
          <tr>
            <th style="width:42px;">Sr</th>
            <th>CT No</th>
            <th>Make</th>
            <th>Cap.</th>
            <th>Ratio</th>
            <th>Polarity</th>
            <th>Result</th>
            <th>Remark</th>
          </tr>
        </thead>
        <tbody class="small">
          <tr *ngFor="let c of ctCert.rows; let i=index">
            <td class="text-center">{{ i+1 }}</td>
            <td>{{ c.ct_no }}</td>
            <td>{{ c.make }}</td>
            <td>{{ c.capacity }}</td>
            <td>{{ c.ratio }}</td>
            <td>{{ c.polarity }}</td>
            <td>{{ c.result }}</td>
            <td>{{ c.remark || '-' }}</td>
          </tr>
        </tbody>
      </table>

      <div class="row mt-4 small">
        <div class="col-6">
          <div class="sig-line">Junior Engineer (RMTL)</div>
        </div>
        <div class="col-6 text-end">
          <div class="sig-line d-inline-block">Assistant Engineer</div>
        </div>
      </div>
    </ng-container>

  </div>
</div>
