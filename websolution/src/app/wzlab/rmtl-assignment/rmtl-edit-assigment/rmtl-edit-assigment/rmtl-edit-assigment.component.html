<div class="container-fluid py-4">
  <div class="card shadow-lg border-0">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0"><i class="fas fa-edit me-2"></i>Edit Assignment</h5>
    </div>
    <div class="card-body">
      <div class="row g-4">
        <div class="col-md-4">
          <label class="form-label fw-bold">Device Status</label>
          <select class="form-select" [(ngModel)]="assignment.device_status" (change)="filterinword()">
            <option *ngFor="let status of device_statuses" [value]="status">{{ status }}</option>
          </select>
        </div>

        <div class="col-md-4">
          <label class="form-label fw-bold">Inward No</label>
          <select class="form-select" [(ngModel)]="assignment.inward_no" (change)="filterUsers()">
            <option *ngFor="let inw of inward_nos" [value]="inw">{{ inw }}</option>
          </select>
        </div>

        <div class="col-md-4">
          <label class="form-label fw-bold">Select User</label>
          <select class="form-select" [(ngModel)]="assignment.selected_user" (change)="filterDevices()">
            <option *ngFor="let user of users_for_inward" [value]="user.id">{{ user.name }}</option>
          </select>
        </div>
      </div>

      <div class="table-responsive mt-4" *ngIf="devices.length > 0">
        <table class="table table-hover table-bordered text-center">
<thead class="table-dark">
  <tr>
    <th>
      <input type="checkbox" (change)="toggleAllDevices($event)" />
    </th>
    <th>Serial No.</th>
    <th>Make</th>
    <th>Device Type</th>
    <th>Phase</th>
    <th>Connection</th>
    <th>Consumer</th>
    <th>Assigned To</th>
    <th>Assigned By</th>
    <th>Bench</th>
    <th>Status</th>
    <th>Assigned At</th>
  </tr>
</thead>
<tbody>
  <tr *ngFor="let entry of devices; let i = index">
    <td>
      <input type="checkbox" [(ngModel)]="entry.selected" />
    </td>
    <td>{{ entry.device.serial_number }}</td>
    <td>{{ entry.device.make }}</td>
    <td>{{ entry.device.device_type }}</td>
    <td>{{ entry.device.phase }}</td>
    <td>{{ entry.device.connection_type }}</td>
    <td>
      <strong>{{ entry.device.consumer_name }}</strong><br />
      <small class="text-muted">{{ entry.device.consumer_no }}</small>
    </td>
    <td>
      {{ entry.user.name }}<br />
      <small class="text-muted">{{ entry.user.designation }}</small>
    </td>
    <td>
      {{ entry.assigned_by_user.name }}<br />
      <small class="text-muted">{{ entry.assigned_by_user.designation }}</small>
    </td>
    <td>{{ entry.bench.bench_name }}</td>
    <td>
      <span class="badge" [ngClass]="{
        'bg-success': entry.assignment.assignment_status === 'ASSIGNED',
        'bg-secondary': entry.assignment.assignment_status === 'UNASSIGNED',
        'bg-warning text-dark': entry.assignment.assignment_status === 'PENDING',
        'bg-info text-dark': entry.assignment.assignment_status === 'COMPLETED',
        'bg-danger': entry.assignment.assignment_status === 'NON_FUNCTIONAL'
      }">
        {{ entry.assignment.assignment_status }}
      </span>
    </td>
    <td>{{ entry.assignment.assigned_datetime | date:'medium' }}</td>
  </tr>
</tbody>

        </table>
      </div>

      <div class="d-flex justify-content-end mt-3">
        <button class="btn btn-success me-2" (click)="openAssignModal()" [disabled]="!hasSelectedDevices()">
          <i class="fas fa-check-circle"></i> Update Assignment
        </button>
        <button class="btn btn-outline-secondary" (click)="cancel()">
          <i class="fas fa-times"></i> Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="assignModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Assign Devices</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Select User</label>
              <select class="form-select" [(ngModel)]="selectedUser">
                <option *ngFor="let user of users" [value]="user.id">{{ user.name }}</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Select Bench</label>
              <select class="form-select" [(ngModel)]="selectedBench">
                <option *ngFor="let bench of benches" [value]="bench.id">{{ bench.bench_name }}</option>
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-primary" (click)="onUpdate()">
            <i class="fas fa-save"></i> Confirm Assignment
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
